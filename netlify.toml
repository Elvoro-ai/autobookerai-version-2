# Netlify configuration for building the Next.js app inside the subfolder `autobooker-ai`
# Works with Next 13 (App Router) using the official Netlify Next.js plugin.
[build]
  base = "autobooker-ai"          # Subdirectory containing the Next.js app
  publish = ".next"               # Output directory generated by `next build`
  command = "npm install && next build"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--legacy-peer-deps"

# Use the official Netlify Next.js plugin (handles SSR/ISR, images, middleware, etc.)
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Optional: If this repo has other folders with package.json, avoid accidental builds
# by ignoring changes outside the app directory.
# Uncomment if needed:
# [build.processing]
#   skip_processing = true

# Security headers (you can adjust CSP as needed; here it's a safe starter with comments).
[[headers]]
  for = "/*"
  [headers.values]
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=(), interest-cohort=()"

# Example redirect: keep clean 404 page
[[redirects]]
  from = "/_next/static/*"
  to = "/_next/static/:splat"
  status = 200
  force = false

# SPA fallback (only if you serve as SPA). For Next SSR this usually isn't needed; keep commented.
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200
